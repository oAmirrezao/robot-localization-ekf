<img width="1210" height="883" alt="img2" src="https://github.com/user-attachments/assets/1f20604f-7740-46e5-92e9-6f33bd1f4f01" />
<br>

## ๐ค ูพุฑูฺู ุชุฎูู ูููุนุช ูุญู ุฑุจุงุช ุฏูุฑุงูุณู ุจุง ููุชุฑ ฺฉุงููู ุชูุณุนูโุงูุชู (EKF)

ุงู ูพุฑูฺู ูพุงุฏูโุณุงุฒ ฺฉ ุณุณุชู ุชุฎูู ูููุนุช ู ุฌูุชโฺฏุฑ ูุญู ุจุฑุง ฺฉ ุฑุจุงุช ฺุฑุฎโุฏุงุฑ ุฏูุฑุงูุณู (Differential Drive) ุจุง ุงุณุชูุงุฏู ุงุฒ ููุชุฑ ฺฉุงููู ุชูุณุนูโุงูุชู (**EKF**) ุฏุฑ ROS 2 (Humble) ุงุณุช. ูุฏู ููุง ุงู ุงุณุช ฺฉู ุฑุจุงุช ุจุชูุงูุฏ ุจุง ุชููู ุฏุงุฏูโูุง ุณูุณูุฑูุง ูุฎุชูู (Odometryุ IMUุ ู Visual Odometry ุดุจูโุณุงุฒ ุดุฏู)ุ ูุณุฑูุง ุชุนูโุดุฏู (ูุงููุฏ ูุณุฑ ูุณุชุทู) ุฑุง ุจุง ุฏูุช ุจุงูุงุชุฑ ูุณุจุช ุจู ุงุณุชูุงุฏู ุงุฒ ูุฑ ุณูุณูุฑ ุจู ุชููุง ุฏูุจุงู ฺฉูุฏ.

-----

### ๐ ฑ. ูพุดโูุงุฒูุง ู ูุญุท ุงุฌุฑุง

ุงู ูพุฑูฺู ุจุฑุง ุงุฌุฑุง ุฏุฑ ูุญุท **ROS 2 Humble** (Ubuntu 22.04) ู ุจู ุทูุฑ ุฎุงุต ุฏุฑ **WSL2** ุชุณุช ู ุจููู ุดุฏู ุงุณุช.

  * **ุณุณุชู ุนุงูู:** Ubuntu 22.04 (ุชุฑุฌุญุงู ุฏุฑ WSL2)
  * **ุชูุฒุน ROS 2:** Humble Hawksbill
  * **ุดุจูโุณุงุฒ:** Gazebo (Ignition)
  * **ูพฺฉุฌโูุง ููุฑุฏ ูุงุฒ (ูพุงุชูู):**
    ```bash
    sudo apt install ros-humble-nav-msgs ros-humble-geometry-msgs ros-humble-sensor-msgs ros-humble-tf-transformations
    ```

-----

### ๐๏ธ ฒ. ุณุงุฎุชุงุฑ ู ุดูุง ฺฉู ูพุฑูฺู

ุงู ูพุฑูฺู ุดุงูู ุฏู ูพฺฉุฌ ุงุตู ุงุณุช ฺฉู ุฏุฑ ฺฉ ูุฑฺฉโุงุณูพุณ (Workspace) ุณุงุฒูุงูุฏู ุดุฏูโุงูุฏ:

```
~/robotic_course-main/
โ
โโโ robot_description/      # ูพฺฉุฌ ุญุงู URDFุ ฺฉูุชุฑูุฑูุง C++ ู ูุงูโูุง ูุงูฺ Gazebo
โ   โโโ scripts/
โ   โ   โโโ motor_command.cpp  # โ๏ธ ฺฉูุชุฑูุฑ ุณููุงุชฺฉ ูุนฺฉูุณ (ุชุจุฏู cmd_vel ุจู ูุฑูุงู ููุชูุฑ)
โ   โโโ src/description/
โ   โ   โโโ robot.urdf         # ๐ค ุชุนุฑู ุฑุจุงุช (ุงุถุงูู ุดุฏู ููุฒ IMU ู ุฏู ููุชูุฑ ูุฌุฒุง)
โ   โโโ ...
โ
โโโ src/
    โโโ robot_autonomy/
        โโโ robot_local_localization/  # ูพฺฉุฌ ุงุตู ูพุงุฏูโุณุงุฒ EKF (ูพุงุชูู)
            โโโ robot_local_localization/
            โ   โโโ prediction_node.py   # ๐จ ููุฏ ูุฏู ุญุฑฺฉุช (Motion Model)
            โ   โโโ measurement_node.py  # ๐งญ ููุฏ ุชุฑฺฉุจ ุงูุฏุงุฒูโฺฏุฑ (IMU + VO)
            โ   โโโ ekf_node.py          # ๐ง ููุฏ EKF (ุชููู ูพุดโุจู ู ุงูุฏุงุฒูโฺฏุฑ)
            โ   โโโ test_node.py         # ๐ ููุฏ ฺฉูุชุฑู ูุณุฑ (Closed-Loop)
            โโโ launch/
                โโโ ekf_localization.launch.py # ๐ ูุงู ูุงูฺ ุงุตู
```

-----

### ๐๏ธ ณ. ูุญูู Build ู ุงุฌุฑุง ูพุฑูฺู

ุจุฑุง ุณุงุฎุช ู ุงุฌุฑุง ูพุฑูฺูุ ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ุฏุฑ ุฑูุช ูุฑฺฉโุงุณูพุณ (`~/robotic_course-main/`) ุฏูุจุงู ฺฉูุฏ:

#### ฺฏุงู ฑ: Build ฺฉุฑุฏู ูุฑฺฉโุงุณูพุณ

ุชูุงู ูพฺฉุฌโูุง C++ ู Python ุฑุง ฺฉุงููพุงู ฺฉูุฏ:

```bash
cd ~/robotic_course-main/
colcon build
```

#### ฺฏุงู ฒ: Source ฺฉุฑุฏู ูุญุท

ูุญุท ROS 2 ุฑุง ุฏุฑ ุชุฑููุงูโูุง ุฌุฏุฏ ูุนุงู ฺฉูุฏ:

```bash
source install/setup.bash
```

#### ฺฏุงู ณ: ุงุฌุฑุง ุดุจูโุณุงุฒ ู EKF

ูุงู ูุงูฺ ุงุตู ฺฉู Gazeboุ RViz ู ุชูุงู ููุฏูุง EKF ู ฺฉูุชุฑูุฑ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ:

```bash
ros2 launch robot_local_localization ekf_localization.launch.py
```

#### ฺฏุงู ด: ูุดุงูุฏู ูุชุงุฌ ุฏุฑ RViz

ุฏุฑ RVizุ ูุทูุฆู ุดูุฏ ฺฉู **Fixed Frame** ุฑู `map` ุชูุธู ุดุฏู ุจุงุดุฏ. ุณูพุณ ุชุงูพฺฉโูุง ุฒุฑ ุฑุง ุงุฒ ููุน `Path` ุงุถุงูู ฺฉูุฏ ุชุง ูุณุฑูุง ูุงุจู ูุดุงูุฏู ุจุงุดูุฏ:

| ููุงุด (Display) | ููุน ูพุงู (Message Type) | ุชุงูพฺฉ (Topic) | ุชูุถุญุงุช |
| :--- | :--- | :--- | :--- |
| **EKF Path** | `nav_msgs/Path` | `/ekf/path` | ูุชุฌู ููุง ุชููู ุณูุณูุฑูุง |
| **Motion Path** | `nav_msgs/Path` | `/motion_model/path` | ูุณุฑ ุจุฑ ุงุณุงุณ ฺุฑุฎโูุง ู ูุฏู ุณููุงุชฺฉ |
| **Measurement Path** | `nav_msgs/Path` | `/measurement_model/path` | ูุณุฑ ุจุฑ ุงุณุงุณ IMU/VO |
| **Real Path (GT)** | `nav_msgs/Path` | `/real/path` | ูุณุฑ ูุงูุน (Wheel Odometry ุงุฒ ุดุจูโุณุงุฒ) |

-----

### ๐ก ด. ุฌุฒุฆุงุช ูพุงุฏูโุณุงุฒ ู ููุฏูุง ุงุตู

#### ุงูู. โ๏ธ `motor_command.cpp` (C++)

  * **ูุฏู:** ูพุงุฏูโุณุงุฒ ุณููุงุชฺฉ ูุนฺฉูุณ (Inverse Kinematics).
  * **ูุฑูุฏ:** ูพุงู `geometry_msgs/Twist` ุงุฒ ุชุงูพฺฉ `/cmd_vel`.
  * **ุฎุฑูุฌ:** ุฏู ูพุงู `std_msgs/Float64` ุจู ุชุงูพฺฉโูุง `/left_motor_rpm` ู `/right_motor_rpm` ฺฉู ุณุฑุนุช ุฒุงููโุง ฺุฑุฎโูุง (ุฏุฑ ูุงูุน rad/s) ุฑุง ุจุฑุง ูพูุงฺฏูโูุง ููุชูุฑ Gazebo ูุฑุงูู ูโฺฉูุฏ.

#### ุจ. ๐จ `prediction_node.py` (Motion Model)

  * **ูุฏู:** ูพุงุฏูโุณุงุฒ ูุฑุญูู **ูพุดโุจู (Prediction)** ุฏุฑ EKF.
  * **ูุฏู:** ูุฏู ุณููุงุชฺฉ ุฏูุฑุงูุณู.
  * **ูุฑูุฏ:** ูพุงู `geometry_msgs/Twist` (ุณุฑุนุช ุฎุท ู ุฒุงููโุง ูุฑูุงู ุฏุงุฏู ุดุฏู).
  * **ุฎุฑูุฌ:** ูพุงู `nav_msgs/Odometry` ุฏุฑ ุชุงูพฺฉ `/motion_model/odom` ุญุงู $\hat{x}_k$ ู ูุงุชุฑุณ ฺฉููุงุฑุงูุณ ูพุดโุจู $P_k^-$.

#### ุฌ. ๐งญ `measurement_node.py` (Measurement Model)

  * **ูุฏู:** ุชุฑฺฉุจ ุงูุฏุงุฒูโฺฏุฑโูุง ุณูุณูุฑูุง (IMU ู Visual Odometry ุดุจูโุณุงุฒ ุดุฏู).
  * **ูุฑูุฏ:** ูพุงูโูุง IMU ู VO (ุง Odom ุงุฒ ฺุฑุฎโูุง).
  * **ูุฑููู:** ูุญุงุณุจู ูุฏู ุงูุฏุงุฒูโฺฏุฑ ุชุฑฺฉุจ ุดุฏู $z_k$ ู ูุงุชุฑุณ ฺฉููุงุฑุงูุณ ุงูุฏุงุฒูโฺฏุฑ $R_k$.
  * **ุฎุฑูุฌ:** ูพุงู `geometry_msgs/PoseWithCovarianceStamped` ุฏุฑ ุชุงูพฺฉ `/measurement_model/pose`.

#### ุฏ. ๐ง `ekf_node.py` (EKF Implementation)

  * **ูุฏู:** ูพุงุฏูโุณุงุฒ ุงูฺฏูุฑุชู EKF.
  * **ูุฑูุฏโูุง:**
      * `/motion_model/odom` (ูพุดโุจู $\hat{x}_k^-$ ู $P_k^-$)
      * `/measurement_model/pose` (ุงูุฏุงุฒูโฺฏุฑ $z_k$ ู $R_k$)
  * **ุฎุฑูุฌ:** ูพุงู ููุง `nav_msgs/Odometry` ุฏุฑ ุชุงูพฺฉ `/ekf/odom` (ุชุฎูู ุงุตูุงุญโุดุฏู $\hat{x}_k$).

#### ู. ๐ `test_node.py` (Rectangle Path Control)

  * **ูุฏู:** ุงุฌุฑุง ูุณุฑ ูุณุชุทู ุจุง ุงุณุชูุงุฏู ุงุฒ **ฺฉูุชุฑู ุญููู ุจุณุชู (Closed-Loop)**.
  * **ูุฑูุฏ:** `/ekf/odom` (ูููุนุช ุชุฎูู EKF).
  * **ุนููฺฉุฑุฏ:** ุจู ุฌุง ุงุนุชูุงุฏ ุจู ุฒูุงู (Time-based)ุ ุงุฒ ูููุนุช ุชุฎูู EKF ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ูุงุตูู ู ุฒุงูู ุท ุดุฏู ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง ูุณุชุทู ุจุง ุฏูุช ุจุงูุง ุจุณุชู ุดูุฏ.
  * **ุฎุฑูุฌ:** ูพุงู `geometry_msgs/Twist` ุจู `/cmd_vel`.

-----

### ๐ง ต. ฺุงูุดโูุง ู ุฑุงูโุญูโูุง ูพุงุฏูโุณุงุฒ

| ฺุงูุด (Issue) | ุชูุถุญ ูุดฺฉู | ุฑุงูโุญู ูพุงุฏูโุณุงุฒ ุดุฏู |
| :--- | :--- | :--- |
| **ุชุจุฏู ูุฑูุงู** | ุนุฏู ุญุฑฺฉุช ุฑุจุงุช ุฏุฑ Gazebo ุง ุญุฑฺฉุช ุบุฑูุงุจู ฺฉูุชุฑู. ุฏุฑ ุงุจุชุฏุง ููุทู ุณููุงุชฺฉ ูุนฺฉูุณ ุฏุฑ `motor_command.cpp` ูุฌูุฏ ูุฏุงุดุช. | ูพุงุฏูโุณุงุฒ ุฏูู **ุณููุงุชฺฉ ูุนฺฉูุณ** ุฏุฑ `motor_command.cpp` ุจุฑุง ุชุจุฏู ุณุฑุนุช ุฎุท ู ุฒุงููโุง (`Twist`) ุจู ุณุฑุนุช ฺุฑุฎโูุง (`Float64`). |
| **ุฎุทุง ูุณุฑ (Drift)** | ูุณุชุทู ุจู ุฏุฑุณุช ุจุณุชู ููโุดุฏ ู ฺุฑุฎุดโูุง ฺฉูุชุฑ ุงุฒ นฐ ุฏุฑุฌู ุจูุฏูุฏ (ุญุฑฺฉุช ฑฐ ุฏูููโุง). | ุชุจุฏู ฺฉูุชุฑู ูุณุฑ ุฏุฑ `test_node.py` ุงุฒ ุญุงูุช **ุญููู ุจุงุฒ (Open-Loop)** ุจู **ุญููู ุจุณุชู (Closed-Loop)**ุ ุจุง ุงุณุชูุงุฏู ุงุฒ ูุฏุจฺฉ ูููุนุช EKF ุจุฑุง ูพุงุงู ูุฑ ุณฺฏููุช. |
| **ูุดฺฉูุงุช ุฒูุงู ROS 2** | ูุงููุงููฺฏ ุจู ุณุงุนุช ุณุณุชู ู ุณุงุนุช Gazebo (ูุฎุตูุตุงู ุฏุฑ WSL) ฺฉู ุจุงุนุซ ูโุดุฏ ุฏุงุฏูโูุง ุณูุณูุฑ ูุฏู ุชูู ุดููุฏ ู ุชูุณุท EKF ูุงุฏุฏู ฺฏุฑูุชู ุดููุฏ. | ูุนุงูโุณุงุฒ ูพุงุฑุงูุชุฑ `use_sim_time: True` ุจุฑุง ุชูุงู ููุฏูุง ุณุณุชู ุฏุฑ ูุงู ูุงูฺ `ekf_localization.launch.py`. |
| **ุจุฎุด ุงูุชุงุฒ (Foxglove)** | ุนุฏู ุชููุฏ ูุงู `.mcap` (ุชููุฏ ูุฑูุช `.db3` ูพุดโูุฑุถ). | ุงุณุชูุงุฏู ุงุฒ ูุฑูุช ูพุดโูุฑุถ `.db3` ฺฉู ุชูุณุท Foxglove ูพุดุชุจุงู ูโุดูุฏุ ุง ูุตุจ ูพูุงฺฏู `ros-humble-rosbag2-storage-mcap` ู ุถุจุท ูุฌุฏุฏ ุจุง ุขูพุดู `-s mcap`. |

-----

### ๐ ถ. ุจุฎุด ุงูุชุงุฒ (Foxglove ู Rosbag)

ุจุฑุง ุซุจุช ู ุชุญูู ุฏุงุฏูโูุง ุนููฺฉุฑุฏ ุณุณุชูุ ุงุฒ ุงุจุฒุงุฑูุง `rosbag` ู **Foxglove Studio** ุงุณุชูุงุฏู ุดุฏ.

1.  **ุถุจุท ุฏุงุฏูโูุง:** ุงุฌุฑุง ุฏุณุชูุฑ ุฒุฑ ุฏุฑ ุญู ุญุฑฺฉุช ุฑุจุงุชุ ุฏุงุฏูโูุง ูุงุฒู ุจุฑุง ูุตูุฑุณุงุฒ ุฑุง ุฏุฑ ูุงูุจ `.db3` ุง `.mcap` ุฐุฎุฑู ูโฺฉูุฏ:
    ```bash
    ros2 bag record -s mcap -o final_data /ekf/path /motion_model/path /measurement_model/path /real/path /tf /tf_static
    ```
2.  **ุชุญูู ุฏุฑ Foxglove:** ุจุง ุจุงุฑฺฏุฐุงุฑ ูุงู ุถุจุท ุดุฏู ุฏุฑ Foxglove Studioุ ูโุชูุงู ูุณุฑูุง ุชุฎูู EKFุ ูุฏู ุญุฑฺฉุชุ ุงูุฏุงุฒูโฺฏุฑ ู ูุณุฑ ูุงูุน ุฑุง ุจู ุทูุฑ ููุฒูุงู ู ุฑูฺฏ ูุดุงูุฏู ู ุชุญูู ฺฉุฑุฏ ุชุง ุฏูุช ุชููู ุณูุณูุฑูุง ุงุฑุฒุงุจ ุดูุฏ.

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/73c24ee7-b066-426d-ab2d-1d491a0fa77e" width="300"/>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/cd52cd0e-82ec-4246-8fa4-4a0385b2b5ca" width="300"/>
    </td>
  </tr>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/39491ada-20af-4063-9615-5f1f79693ee9" width="300"/>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/e4b6fe72-a83f-4b7f-936a-9f0758069a77" width="300"/>
    </td>
  </tr>
</table>


